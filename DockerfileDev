# 第一阶段：构建 Next.js 应用
FROM registry.cn-hangzhou.aliyuncs.com/liuyi778/node-20-alpine AS builder

# 设置工作目录
WORKDIR /thrive/blog_source

# 配置 npm 镜像源
#RUN npm config set registry https://registry.npmmirror.com

# 复制 package.json 和 package-lock.json
COPY package*.json .

# 安装依赖
RUN npm install&&npm install -g next react react-dom pnpm

# 复制所有文件到工作目录
COPY . .

RUN next build


RUN rm -rf .github .gitignore .git .gitattributes ./node_modules ./images *.md ./Dockerfile*
RUN mv /thrive/blog_source/RunDev.sh /&& chmod +x /RunDev.sh

WORKDIR /thrive/blog



# 暴露端口
EXPOSE 9001

CMD ["/RunDev.sh"]