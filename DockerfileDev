# 第一阶段：构建 Next.js 应用
FROM registry.cn-hangzhou.aliyuncs.com/liuyi778/node-20-alpine AS builder

# 设置工作目录
WORKDIR /thrive/blog

# 配置 npm 镜像源
RUN npm config set registry https://registry.npmmirror.com

# 复制 package.json 和 package-lock.json
COPY package*.json .

# 安装依赖
RUN npm install

# 复制所有文件到工作目录
COPY . .

RUN rm -rf .github .gitignore .git .gitattributes .next ./node_modules ./images *.md ./Dockerfile*

# 暴露端口
EXPOSE 9001

CMD ["next", "start", "-p", "9001"]